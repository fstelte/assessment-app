<!doctype html>
<html lang="en" data-bs-theme="dark">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>BIA Report â€“ {{ item.name }}</title>
    <style nonce="{{ csp_nonce }}">
      body { font-family: "Helvetica Neue", Helvetica, Arial, sans-serif; background-color: #1a202c; color: #cbd5e0; }
      @media print {
        body { background-color: white; color: black; }
        .no-print { display: none; }
      }
      .badge-impact { text-transform: capitalize; }
      .bg-card { background-color: #2d3748; }
      .border-card { border-color: #4a5568; }
    </style>
      {% if export_mode and export_css %}
    <style nonce="{{ csp_nonce }}">
      {{ export_css|safe }}
    </style>
    {% endif %}
  </head>
  <body class="p-8">
    <div class="max-w-5xl mx-auto">
      <header class="mb-8 border-b border-gray-700 pb-4">
        <div class="flex justify-between items-center">
            <div>
                 <h1 class="text-4xl font-bold mb-1">Business Impact Analysis</h1>
                 <p class="text-gray-500 mb-0">{{ _('bia.export_item.generated_note') }}</p>
            </div>
            <button onclick="window.print()" class="no-print bg-blue-600 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded inline-flex items-center">
                <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 17h2a2 2 0 002-2v-4a2 2 0 00-2-2H5a2 2 0 00-2 2v4a2 2 0 002 2h2m2 4h6a2 2 0 002-2v-4a2 2 0 00-2-2H9a2 2 0 00-2 2v4a2 2 0 002 2zm8-12V5a2 2 0 00-2-2H9a2 2 0 00-2 2v4h10z"></path></svg>
                Print Report
            </button>
        </div>
      </header>
      <section class="mb-8">
        <div class="bg-card border border-card rounded-xl shadow-lg overflow-hidden">
          <div class="px-6 py-4 border-b border-gray-600 bg-gray-700">
            <h2 class="text-xl font-bold text-white mb-0">{{ item.name }}</h2>
          </div>
          <div class="p-6">
            <div class="flex flex-wrap -mx-4">
              <div class="w-full lg:w-2/3 px-4 mb-6 lg:mb-0">
                <h3 class="text-lg font-semibold mb-2 text-white">Executive summary</h3>
                <div class="prose prose-invert max-w-none text-gray-300">
                    {{ item.summary.content|default("No summary provided.", true)|safe }}
                </div>
              </div>
              <div class="w-full lg:w-1/3 px-4">
                <div class="bg-gray-800 rounded-lg p-4">
                    <dl class="space-y-2 text-sm">
                    <div class="flex justify-between border-b border-gray-700 pb-2">
                        <dt class="text-gray-400">{{ _('bia.export_item.fields.owner') }}</dt>
                        <dd class="font-medium text-white">{{ item.responsible or 'N/A' }}</dd>
                    </div>
                    <div class="flex justify-between border-b border-gray-700 pb-2">
                        <dt class="text-gray-400">{{ _('bia.export_item.fields.coordinator') }}</dt>
                        <dd class="font-medium text-white">{{ item.coordinator or 'N/A' }}</dd>
                    </div>
                    <div class="flex justify-between border-b border-gray-700 pb-2">
                        <dt class="text-gray-400">{{ _('bia.export_item.fields.project_lead') }}</dt>
                        <dd class="font-medium text-white">{{ item.project_leader or 'N/A' }}</dd>
                    </div>
                    <div class="flex justify-between border-b border-gray-700 pb-2">
                        <dt class="text-gray-400">{{ _('bia.export_item.fields.product_owner') }}</dt>
                        <dd class="font-medium text-white">{{ item.product_owner or 'N/A' }}</dd>
                    </div>
                    <div class="flex justify-between">
                        <dt class="text-gray-400">{{ _('bia.export_item.fields.risk_owner') }}</dt>
                        <dd class="font-medium text-white">{{ item.risk_owner or 'N/A' }}</dd>
                    </div>
                    </dl>
                </div>
              </div>
            </div>
          </div>
        </div>
      </section>
      <section class="mb-8">
        <div class="bg-card border border-card rounded-xl shadow-lg overflow-hidden">
          <div class="px-6 py-4 border-b border-gray-600 bg-gray-700">
            <h2 class="text-lg font-bold text-white mb-0">Scope & context</h2>
          </div>
          <div class="p-6">
            <div class="flex flex-wrap -mx-4">
              <div class="w-full lg:w-1/2 px-4 mb-6 lg:mb-0">
                <div class="mb-4">
                    <h3 class="text-xs font-bold uppercase tracking-wider text-gray-500 mb-1">Service description</h3>
                    <p class="text-gray-300">{{ item.service_description or 'N/A' }}</p>
                </div>
                <div>
                    <h3 class="text-xs font-bold uppercase tracking-wider text-gray-500 mb-1">Scope</h3>
                    <p class="text-gray-300">{{ item.scope_description or 'N/A' }}</p>
                </div>
              </div>
              <div class="w-full lg:w-1/2 px-4">
                <table class="min-w-full divide-y divide-gray-700">
                  <tbody class="divide-y divide-gray-700">
                    <tr>
                      <th scope="row" class="text-left py-2 font-medium text-gray-400">{{ _('bia.export_item.fields.knowledge') }}</th>
                      <td class="text-right py-2 text-gray-300">{{ item.knowledge or 'N/A' }}</td>
                    </tr>
                    <tr>
                      <th scope="row" class="text-left py-2 font-medium text-gray-400">{{ _('bia.export_item.fields.interfaces') }}</th>
                      <td class="text-right py-2 text-gray-300">{{ item.interfaces or 'N/A' }}</td>
                    </tr>
                    <tr>
                      <th scope="row" class="text-left py-2 font-medium text-gray-400">{{ _('bia.export_item.fields.mission_critical') }}</th>
                      <td class="text-right py-2 text-gray-300">{{ item.mission_critical or 'N/A' }}</td>
                    </tr>
                    <tr>
                      <th scope="row" class="text-left py-2 font-medium text-gray-400">{{ _('bia.export_item.fields.support_contracts') }}</th>
                      <td class="text-right py-2 text-gray-300">{{ item.support_contracts or 'N/A' }}</td>
                    </tr>
                    <tr>
                      <th scope="row" class="text-left py-2 font-medium text-gray-400">{{ _('bia.export_item.fields.security_supplier') }}</th>
                      <td class="text-right py-2 text-gray-300">{{ item.security_supplier or 'N/A' }}</td>
                    </tr>
                    <tr>
                      <th scope="row" class="text-left py-2 font-medium text-gray-400">{{ _('bia.export_item.fields.users') }}</th>
                      <td class="text-right py-2 text-gray-300">{{ item.user_amount or 'Unknown' }}</td>
                    </tr>
                    <tr>
                      <th scope="row" class="text-left py-2 font-medium text-gray-400">{{ _('bia.export_item.fields.ai_model_in_scope') }}</th>
                      <td class="text-right py-2 text-gray-300">{{ 'Yes' if item.ai_model else 'No' }}</td>
                    </tr>
                    <tr>
                      <th scope="row" class="text-left py-2 font-medium text-gray-400">{{ _('bia.export_item.fields.last_update') }}</th>
                      <td class="text-right py-2 text-gray-300">{{ item.last_update or 'N/A' }}</td>
                    </tr>
                  </tbody>
                </table>
              </div>
            </div>
          </div>
        </div>
      </section>
      <section class="mb-8">
        <div class="bg-card border border-card rounded-xl shadow-lg overflow-hidden">
            <div class="px-6 py-4 border-b border-gray-600 bg-gray-700">
                <h2 class="text-lg font-bold text-white mb-0">Risk assessments</h2>
            </div>
          <div class="p-6">
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-6">
                <!-- People -->
                <div class="bg-gray-800 rounded-lg p-4 text-center border border-gray-700">
                    <div class="text-xs font-bold uppercase tracking-wider text-gray-500 mb-2">People</div>
                    <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium {{ 'bg-green-100 text-green-800' if item.risk_assessment_human else 'bg-gray-100 text-gray-800' }}">
                        {{ 'Required' if item.risk_assessment_human else 'Not required' }}
                    </span>
                </div>
                <!-- Process -->
                <div class="bg-gray-800 rounded-lg p-4 text-center border border-gray-700">
                    <div class="text-xs font-bold uppercase tracking-wider text-gray-500 mb-2">Process</div>
                    <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium {{ 'bg-green-100 text-green-800' if item.risk_assessment_process else 'bg-gray-100 text-gray-800' }}">
                        {{ 'Required' if item.risk_assessment_process else 'Not required' }}
                    </span>
                </div>
                <!-- Technology -->
                <div class="bg-gray-800 rounded-lg p-4 text-center border border-gray-700">
                    <div class="text-xs font-bold uppercase tracking-wider text-gray-500 mb-2">Technology</div>
                    <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium {{ 'bg-green-100 text-green-800' if item.risk_assessment_technological else 'bg-gray-100 text-gray-800' }}">
                        {{ 'Required' if item.risk_assessment_technological else 'Not required' }}
                    </span>
                </div>
            </div>
            <div>
              <h3 class="text-sm font-bold uppercase tracking-wider text-gray-400 mb-3">AI identification</h3>
              {% if ai_identifications %}
                <div class="bg-gray-800 rounded-lg border border-gray-700 overflow-hidden">
                    <ul class="divide-y divide-gray-700">
                    {% for component in item.components %}
                        {% set ai = ai_identifications.get(component.id) %}
                        {% if ai %}
                        <li class="px-4 py-3">
                        <div class="flex justify-between mb-1">
                            <span class="font-semibold text-white">{{ component.name }}</span>
                            <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-indigo-100 text-indigo-800">{{ ai.category }}</span>
                        </div>
                        <p class="text-sm text-gray-400 mb-0">{{ ai.motivatie or 'No details provided.' }}</p>
                        </li>
                        {% endif %}
                    {% endfor %}
                    </ul>
                </div>
              {% else %}
                <p class="text-gray-500 italic">{{ _('bia.export_item.empty.ai_risks') }}</p>
              {% endif %}
            </div>
          </div>
        </div>
      </section>
      <section class="mb-8">
        <div class="bg-card border border-card rounded-xl shadow-lg overflow-hidden">
            <div class="px-6 py-4 border-b border-gray-600 bg-gray-700 flex justify-between items-center">
                <h2 class="text-lg font-bold text-white mb-0">{{ _('bia.context_detail.sections.consequences') }}</h2>
                <div class="flex gap-2 text-xs">
                    {% for prop, label in {'confidentiality': 'Confidentiality', 'integrity': 'Integrity', 'availability': 'Availability'}.items() %}
                    {% set value = max_cia_impact.get(prop) %}
                    <span class="inline-flex items-center px-2 py-0.5 rounded text-white border border-gray-500 {{ bia_get_impact_color(value) }} opacity-75">
                         {{ label[0] }}: {{ value or 'n/a' }}
                    </span>
                    {% endfor %}
                </div>
            </div>
          <div class="p-0">
            {% if consequences %}
            <div class="overflow-x-auto">
              <table class="min-w-full divide-y divide-gray-700">
                <thead class="bg-gray-800">
                  <tr>
                    <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-400 uppercase tracking-wider">{{ _('bia.export_item.table.component') }}</th>
                    <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-400 uppercase tracking-wider">{{ _('bia.export_item.table.category') }}</th>
                    <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-400 uppercase tracking-wider">{{ _('bia.export_item.table.security_property') }}</th>
                    <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-400 uppercase tracking-wider">{{ _('bia.export_item.table.worst_case') }}</th>
                    <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-400 uppercase tracking-wider">{{ _('bia.export_item.table.realistic_case') }}</th>
                    <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-400 uppercase tracking-wider">{{ _('bia.export_item.table.cia_impact') }}</th>
                  </tr>
                </thead>
                <tbody class="bg-card divide-y divide-gray-700">
                  {% for consequence in consequences %}
                  <tr>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-white font-medium">{{ consequence.component.name }}</td>
                    <td class="px-6 py-4 text-sm text-gray-300">
                        <div class="max-w-xs break-words">
                            {{ consequence.consequence_category }}
                        </div>
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-300 uppercase">{{ consequence.security_property }}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-300">
                      {{ consequence.consequence_worstcase or 'N/A' }}
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-300">
                       {{ consequence.consequence_realisticcase or 'N/A' }}
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap text-xs text-gray-400">
                      <div class="flex flex-col gap-1">
                        <span>C: {{ bia_get_cia_impact(consequence, 'confidentiality') }}</span>
                        <span>I: {{ bia_get_cia_impact(consequence, 'integrity') }}</span>
                        <span>A: {{ bia_get_cia_impact(consequence, 'availability') }}</span>
                      </div>
                    </td>
                  </tr>
                  {% endfor %}
                </tbody>
              </table>
            </div>
            {% else %}
            <div class="p-6 text-center text-gray-500 italic">{{ _('bia.export_item.empty.consequences') }}</div>
            {% endif %}
          </div>
        </div>
      </section>
      <section class="mb-8">
        <div class="bg-card border border-card rounded-xl shadow-lg overflow-hidden">
            <div class="px-6 py-4 border-b border-gray-600 bg-gray-700">
                <h2 class="text-lg font-bold text-white mb-0">{{ _('bia.context_detail.sections.components') }}</h2>
            </div>
          <div class="p-0">
            {% if item.components %}
            <div class="overflow-x-auto">
              <table class="min-w-full divide-y divide-gray-700">
                <thead class="bg-gray-800">
                  <tr>
                    <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-400 uppercase tracking-wider">{{ _('bia.export_item.table.component') }}</th>
                    <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-400 uppercase tracking-wider">{{ _('bia.export_item.table.information_type') }}</th>
                    <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-400 uppercase tracking-wider">{{ _('bia.export_item.table.authentication') }}</th>
                    <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-400 uppercase tracking-wider">{{ _('bia.context_detail.table.owner') }}</th>
                    <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-400 uppercase tracking-wider">{{ _('bia.export_item.table.description') }}</th>
                  </tr>
                </thead>
                <tbody class="bg-card divide-y divide-gray-700">
                  {% for component in item.components %}
                  <tr>
                    <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-white">{{ component.name }}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-300">{{ component.info_type or 'N/A' }}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-300">
                      {% set auth_label = bia_component_authentication(component) %}
                      {% if auth_label %}
                      <div>{{ auth_label }}</div>
                      {% if component.authentication_method %}
                      <div class="text-gray-500 text-xs">{{ component.authentication_method.slug }}</div>
                      {% endif %}
                      {% else %}
                      N/A
                      {% endif %}
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-300">{{ component.info_owner or 'N/A' }}</td>
                    <td class="px-6 py-4 text-sm text-gray-300 max-w-xs truncate" title="{{ component.description }}">{{ component.description or 'N/A' }}</td>
                  </tr>
                  {% endfor %}
                </tbody>
              </table>
            </div>
            {% else %}
            <div class="p-6 text-center text-gray-500 italic">{{ _('bia.export_item.empty.components') }}</div>
            {% endif %}
          </div>
        </div>
      </section>
      <section>
        <div class="bg-card border border-card rounded-xl shadow-lg overflow-hidden">
            <div class="px-6 py-4 border-b border-gray-600 bg-gray-700">
                <h2 class="text-lg font-bold text-white mb-0">{{ _('bia.context_detail.sections.availability') }}</h2>
            </div>
          <div class="p-0">
            <div class="overflow-x-auto">
              <table class="min-w-full divide-y divide-gray-700">
                <thead class="bg-gray-800">
                  <tr>
                    <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-400 uppercase tracking-wider">{{ _('bia.export_item.table.component') }}</th>
                    <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-400 uppercase tracking-wider">{{ _('bia.export_item.table.mtd') }}</th>
                    <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-400 uppercase tracking-wider">{{ _('bia.export_item.table.rto') }}</th>
                    <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-400 uppercase tracking-wider">{{ _('bia.export_item.table.rpo') }}</th>
                    <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-400 uppercase tracking-wider">{{ _('bia.export_item.table.masl') }}</th>
                  </tr>
                </thead>
                <tbody class="bg-card divide-y divide-gray-700">
                  {% for component in item.components %}
                  {% set availability = component.availability_requirement %}
                  <tr>
                    <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-white">{{ component.name }}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-300">{{ availability.mtd if availability else 'N/A' }}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-300">{{ availability.rto if availability else 'N/A' }}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-300">{{ availability.rpo if availability else 'N/A' }}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-300">{{ availability.masl if availability else 'N/A' }}</td>
                  </tr>
                  {% else %}
                  <tr>
                    <td colspan="5" class="px-6 py-4 text-center text-gray-500 italic">{{ _('bia.export_item.empty.components_table') }}</td>
                  </tr>
                  {% endfor %}
                </tbody>
              </table>
            </div>
          </div>
        </div>
      </section>
    </div>
  </body>
</html>