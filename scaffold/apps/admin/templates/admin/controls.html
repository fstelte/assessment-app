{% extends "base.html" %}
{% import "macros.html" as macros %}

{% block title %}{{ _('admin.controls.title') }}{% endblock %}

{% block content %}
<div class="flex flex-col lg:flex-row justify-between lg:items-center gap-3 mb-4">
  <div>
    <h1 class="text-2xl font-bold mb-1">{{ _('admin.controls.heading') }}</h1>
    <p class="text-[var(--color-muted)] mb-0">{{ _('admin.controls.subtitle') }}</p>
  </div>
  <div class="flex flex-wrap gap-2">
      <a href="{{ url_for('admin.bia_tiers_list') }}" class="inline-flex items-center justify-center font-medium rounded-md px-4 py-2 text-sm transition-colors border border-[var(--color-border)] text-[var(--color-text)] hover:bg-white/5">
         {{ _('admin.controls.manage_availability_tiers') }}
      </a>
      {% if not has_controls %}
         <div class="flex gap-2">
             <form method="post" action="{{ url_for('admin.import_default_controls', standard='iso27002') }}">
                 <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
                 <button type="submit" class="inline-flex items-center justify-center font-medium rounded-md px-4 py-2 text-sm transition-colors border border-[var(--color-border)] text-[var(--color-text)] hover:bg-white/5">
                     {{ _('admin.controls.import_iso') }}
                 </button>
             </form>
             <form method="post" action="{{ url_for('admin.import_default_controls', standard='nist80053') }}">
                 <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
                 <button type="submit" class="inline-flex items-center justify-center font-medium rounded-md px-4 py-2 text-sm transition-colors border border-[var(--color-border)] text-[var(--color-text)] hover:bg-white/5">
                     {{ _('admin.controls.import_nist') }}
                 </button>
             </form>
         </div>
      {% endif %}
      <a href="{{ url_for('admin.new_control') }}" class="inline-flex items-center justify-center font-medium rounded-md px-4 py-2 text-sm transition-colors bg-primary-600 text-white hover:bg-primary-700">
         {{ _('admin.controls.new_control') }}
      </a>
  </div>
</div>

<div class="bg-[var(--color-card)] rounded-lg shadow-sm border border-[var(--color-border)] mb-4 p-4">
    <form method="get" class="flex flex-wrap lg:flex-nowrap gap-4 items-end">
        <div class="w-full lg:w-1/3">
            <label class="block text-sm font-medium text-[var(--color-text)] mb-1">{{ _('admin.controls.filter.identifier') }}</label>
            <input type="text" name="identifier" class="w-full rounded-md bg-[var(--color-surface)] border border-[var(--color-border)] text-[var(--color-text)] px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-primary-500/50" value="{{ request.args.get('identifier', '') }}" placeholder="e.g. AC-1">
        </div>
        <div class="w-full lg:w-1/3">
            <label class="block text-sm font-medium text-[var(--color-text)] mb-1">{{ _('admin.controls.filter.keyword') }}</label>
            <input type="text" name="keyword" class="w-full rounded-md bg-[var(--color-surface)] border border-[var(--color-border)] text-[var(--color-text)] px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-primary-500/50" value="{{ request.args.get('keyword', '') }}" placeholder="{{ _('admin.controls.filter.keyword.placeholder') }}">
        </div>
        <div class="w-full lg:w-auto">
            <button type="submit" class="inline-flex items-center justify-center font-medium rounded-md px-4 py-2 text-sm transition-colors bg-primary-600 text-white hover:bg-primary-700 w-full lg:w-auto">
                {{ _('admin.controls.filter.search') }}
            </button>
        </div>
        {% if request.args %}
        <div class="w-full lg:w-auto">
            <a href="{{ url_for('admin.controls') }}" class="inline-flex items-center justify-center font-medium rounded-md px-4 py-2 text-sm transition-colors border border-[var(--color-border)] text-[var(--color-text)] hover:bg-white/5 w-full lg:w-auto">
                {{ _('admin.controls.filter.clear') }}
            </a>
        </div>
        {% endif %}
    </form>
</div>

<div class="overflow-x-auto w-full rounded-md border border-[var(--color-border)] mb-4">
  <table class="w-full text-sm text-left border-collapse bg-[var(--color-card)]">
    <thead class="bg-[var(--color-surface)] text-[var(--color-text)] border-b border-[var(--color-border)]">
      <tr>
        <th scope="col" class="px-4 py-3 font-semibold w-24">{{ _('admin.controls.table.id') }}</th>
        <th scope="col" class="px-4 py-3 font-semibold w-1/4">{{ _('admin.controls.table.name') }}</th>
        <th scope="col" class="px-4 py-3 font-semibold">{{ _('admin.controls.table.description') }}</th>
        <th scope="col" class="px-4 py-3 font-semibold w-24 text-right">{{ _('admin.controls.table.actions') }}</th>
      </tr>
    </thead>
    <tbody class="divide-y divide-[var(--color-border)]">
      {% for control in pagination.items %}
      <tr class="hover:bg-slate-500/5 transition-colors">
        <td class="px-4 py-3 align-top font-mono text-primary-400 font-medium">
            {{ control.identifier }}
        </td>
        <td class="px-4 py-3 align-top font-medium">
            {{ control.title }}
        </td>
        <td class="px-4 py-3 align-top text-[var(--color-muted)]">
            <div class="line-clamp-2" title="{{ control.description }}">
                {{ control.description }}
            </div>
        </td>
        <td class="px-4 py-3 align-top text-right">
            <a href="{{ url_for('admin.edit_control', control_id=control.id) }}" class="inline-flex items-center justify-center font-medium rounded-md px-3 py-1.5 text-xs transition-colors border border-[var(--color-border)] text-[var(--color-text)] hover:bg-white/5">
                {{ _('admin.controls.edit') }}
            </a>
        </td>
      </tr>
      {% else %}
      <tr>
          <td colspan="4" class="px-4 py-8 text-center text-[var(--color-muted)]">
              {{ _('admin.controls.no_controls') }}
          </td>
      </tr>
      {% endfor %}
    </tbody>
  </table>
</div>

<div class="flex justify-center mt-4">
    {{ macros.render_pagination(pagination, 'admin.controls') }}
</div>
{% endblock %}