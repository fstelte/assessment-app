{% extends "base.html" %}

{% block title %}{{ _('bia.archived.title') }}{% endblock %}

{% block extra_css %}
<style nonce="{{ csp_nonce }}">
.bia-dashboard {
    display: flex;
    flex-direction: column;
    gap: 2rem;
}
.bia-dashboard-hero {
    background: linear-gradient(130deg, rgba(108, 117, 125, 0.95), rgba(73, 80, 87, 0.95));
    border-radius: 1.5rem;
    padding: clamp(1.75rem, 4vw, 2.5rem);
    box-shadow: 0 1.25rem 3rem rgba(15, 23, 42, 0.25);
    color: #fff;
    position: relative;
    overflow: hidden;
}
body[data-theme="dark"] .bia-dashboard-hero {
    background: linear-gradient(130deg, rgba(108, 117, 125, 0.6), rgba(73, 80, 87, 0.7));
    box-shadow: 0 1rem 2.5rem rgba(0, 0, 0, 0.45);
    border: 1px solid rgba(255, 255, 255, 0.08);
}
.bia-dashboard-hero::after {
    content: "";
    position: absolute;
    width: 320px;
    height: 320px;
    background: radial-gradient(circle, rgba(255, 255, 255, 0.2), transparent 65%);
    right: -80px;
    top: -60px;
    filter: blur(4px);
}
.bia-dashboard-hero__body {
    position: relative;
    z-index: 1;
}
</style>
{% endblock %}

{% block content %}
{% set is_dark = theme != 'light' %}
{% set table_class = 'table-dark' if is_dark else '' %}
{% set text_muted = 'text-white-50' if is_dark else 'text-muted' %}

<div class="bia-dashboard">
    <section class="bia-dashboard-hero">
        <div class="bia-dashboard-hero__body d-flex flex-column flex-md-row justify-content-between align-items-center gap-4">
            <div>
                <nav aria-label="breadcrumb">
                    <ol class="breadcrumb mb-2">
                        <li class="breadcrumb-item"><a href="{{ url_for('bia.dashboard') }}" class="text-white text-decoration-none">&larr; {{ _('bia.dashboard.header.title') }}</a></li>
                        <li class="breadcrumb-item active text-white-50" aria-current="page">{{ _('bia.archived.title') }}</li>
                    </ol>
                </nav>
                <h1 class="display-6 fw-semibold mb-0">{{ _('bia.archived.title') }}</h1>
            </div>
            <div class="d-none d-md-block">
                <i class="fas fa-archive fa-3x text-white-50"></i>
            </div>
        </div>
    </section>

    <section>
        {% if contexts %}
        <div class="card shadow-sm border-0 {% if is_dark %}bg-dark border border-secondary{% endif %}">
            <div class="card-body p-0">
                <div class="table-responsive">
                    <table class="table table-hover align-middle mb-0 {{ table_class }}">
                        <thead class="{% if not is_dark %}bg-light{% endif %} text-uppercase small text-secondary">
                            <tr>
                                <th scope="col" class="ps-4 py-3">{{ _('bia.context_form.fields.name.label') }}</th>
                                <th scope="col" class="py-3">{{ _('bia.context_form.fields.responsible.label') }}</th>
                                <th scope="col" class="py-3">{{ _('bia.context_form.fields.tier.label') }}</th>
                                <th scope="col" class="py-3">{{ _('bia.archived.archived_at') }}</th>
                                <th scope="col" class="pe-4 py-3 text-end">{{ _('bia.common.actions') }}</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for item in contexts %}
                            <tr>
                                <td class="ps-4">
                                    <a href="{{ url_for('bia.view_item', item_id=item.id) }}" class="fw-medium text-decoration-none">
                                        {{ item.name }}
                                    </a>
                                </td>
                                <td>
                                    {{ item.risk_owner or (item.author.full_name if item.author else item.responsible) or '-' }}
                                </td>
                                <td>
                                    {% if item.tier %}
                                        <span class="badge text-bg-secondary">{{ item.tier.get_label() }}</span>
                                    {% else %}
                                        <span class="text-secondary">-</span>
                                    {% endif %}
                                </td>
                                <td class="text-secondary">
                                    {% if item.archived_at %}
                                        {{ item.archived_at.strftime('%Y-%m-%d %H:%M') }}
                                    {% else %}
                                        -
                                    {% endif %}
                                </td>
                                <td class="pe-4 text-end">
                                    <form action="{{ url_for('bia.archive_item', item_id=item.id) }}" method="POST" class="d-inline">
                                        <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
                                        <button type="submit" class="btn btn-sm btn-outline-primary" onclick="return confirm('{{ _('bia.archived.confirm_unarchive') }}')">
                                            <i class="fas fa-box-open me-1"></i> {{ _('bia.archived.unarchive') }}
                                        </button>
                                    </form>
                                </td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
        {% else %}
        <div class="text-center py-5 border rounded-3 bg-light bg-opacity-10" style="border-style: dashed !important;">
            <div class="mb-3">
                <i class="fas fa-box-open fa-3x text-secondary opacity-50"></i>
            </div>
            <h3 class="h5 text-secondary">{{ _('bia.archived.empty') }}</h3>
            <p class="text-muted mb-0">{{ _('bia.archived.empty_subtitle') }}</p>
        </div>
        {% endif %}
    </section>
</div>
{% endblock %}
