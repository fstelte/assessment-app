{% extends "base.html" %}
{% block title %}{{ _('auth.login.title') }}{% endblock %}
{% block main_container_class %}w-full p-0{% endblock %}

{% block content %}
<div class="flex min-h-screen items-center justify-center bg-[var(--color-bg)] px-4">
    <div class="w-full max-w-sm">
        
        {# Language Selector #}
        {% if available_locales %}
            <div class="flex justify-end mb-3">
                <form method="get" class="inline-flex items-center gap-2">
                    {% for key, value in request.args.items() %}
                        {% if key != 'lang' %}
                            <input type="hidden" name="{{ key }}" value="{{ value }}">
                        {% endif %}
                    {% endfor %}
                    <select id="login-language-select" name="lang" class="w-auto bg-transparent text-[var(--color-muted)] border-0 shadow-none cursor-pointer focus:ring-0 text-sm" aria-label="{{ _('app.language.label') }}">
                        {% for locale in available_locales %}
                            <option value="{{ locale }}" {% if locale == current_locale %}selected{% endif %}>{{ _('app.language.option.' ~ locale) }}</option>
                        {% endfor %}
                    </select>
                </form>
            </div>
        {% endif %}

        <div class="bg-[var(--color-card)] border border-[var(--color-border)] rounded-2xl shadow-card overflow-hidden w-full max-w-sm">
            <div class="p-6 sm:p-8">
                <div class="text-center mb-6">
                    <h1 class="text-xl font-bold mb-1">{{ _('auth.login.heading') }}</h1>
                    <p class="text-[var(--color-muted)] text-sm">{{ _('app.home.subtitle') }}</p>
                </div>

                {% set show_password = password_login_enabled and form is not none %}
                
                {% if not saml_login_enabled and not show_password %}
                    <div class="rounded-xl px-4 py-3 text-sm border bg-red-500/10 border-red-400/40 text-red-200 mb-4" role="status">
                        {{ _('auth.login.saml_unavailable') }}
                    </div>
                {% endif %}

                {% if show_password %}
                    <form method="post" novalidate class="space-y-4">
                        {{ form.hidden_tag() }}
                        {% from "partials/forms.html" import render_field_with_help %}
                        
                        {{ render_field_with_help(form.email, class="w-full bg-[var(--color-surface)] border border-[var(--color-border)] rounded-lg px-3.5 py-2.5 text-[var(--color-text)] transition focus:outline-none focus:border-primary-500 focus:ring-2 focus:ring-primary-500/30", placeholder=_('auth.login.fields.email'), autocomplete="username") }}
                        
                        {{ render_field_with_help(form.password, class="w-full bg-[var(--color-surface)] border border-[var(--color-border)] rounded-lg px-3.5 py-2.5 text-[var(--color-text)] transition focus:outline-none focus:border-primary-500 focus:ring-2 focus:ring-primary-500/30", placeholder=_('auth.login.fields.password'), autocomplete="current-password") }}

                        <div class="flex justify-between items-center">
                            <div class="flex items-center gap-2">
                                {{ form.remember_me(class="w-4 h-4 accent-primary-500 rounded border-[var(--color-border)] bg-[var(--color-surface)]", id="remember-me") }}
                                <label for="remember-me" class="text-sm text-[var(--color-muted)]">{{ form.remember_me.label.text }}</label>
                            </div>
                        </div>

                        {{ form.submit(class="inline-flex items-center justify-center font-medium rounded-lg px-4 py-2.5 text-sm transition-colors border border-transparent bg-primary-600 text-white hover:bg-primary-700 w-full font-semibold shadow-card") }}
                    </form>
                {% endif %}

                {% if saml_login_enabled %}
                    {% if show_password %}
                        <div class="relative my-6">
                            <hr class="border-[var(--color-border)]">
                            <span class="absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 px-2 bg-[var(--color-card)] text-[var(--color-muted)] text-xs uppercase font-medium">Or</span>
                        </div>
                    {% endif %}

                    <div class="grid gap-2">
                        <a class="inline-flex items-center justify-center font-medium rounded-lg px-4 py-2.5 text-sm transition-colors border border-[var(--color-border)] text-[var(--color-muted)] hover:bg-slate-500/10 gap-2 w-full" href="{{ url_for('auth.login_saml') }}">
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor" class="text-primary-400">
                                <path d="M4 3h9.5l6.5 9-6.5 9H4l4.5-9L4 3zm5.3 2-3.1 7 3.1 7h3.8l5-7-5-7H9.3z"/>
                            </svg>
                            <span>{{ _('auth.login.saml_enterprise_button') }}</span>
                        </a>
                    </div>
                    
                    {% if not show_password %}
                         <div class="rounded-xl px-4 py-3 text-sm border bg-slate-100/10 border-[var(--color-border)] text-[var(--color-text)] mt-3 mb-0 text-center">
                            {{ _('auth.login.saml_only_notice') }}
                        </div>
                    {% endif %}
                {% endif %}
            </div>
            
            {% if show_password %}
            <div class="px-6 py-4 border-t border-[var(--color-border)] bg-[var(--color-surface)]/50 text-center">
                <p class="mb-0 text-sm text-[var(--color-muted)]">
                    {{ _('auth.login.register_prompt') }} 
                    <a href="{{ url_for('auth.register_user') }}" class="text-[var(--color-accent)] hover:underline font-semibold">{{ _('auth.login.register_link') }}</a>
                </p>
            </div>
            {% endif %}
        </div>
    </div>
</div>
{% endblock %}
