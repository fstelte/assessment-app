{% extends "base.html" %}
{% from "partials/forms.html" import render_field_with_help %}

{% block title %}{{ _('bia.components.edit.title', name=component.name) }}{% endblock %}

{% block content %}
<div class="space-y-4">

  <!-- Breadcrumb / back -->
  <div>
    <a href="{{ url_for('bia.view_components') }}" class="text-[var(--color-muted)] no-underline hover:text-[var(--color-text)] text-sm">&larr; {{ _('bia.components.heading') }}</a>
  </div>

  <div class="bg-[var(--color-card)] border border-[var(--color-border)] rounded-xl shadow-sm overflow-hidden">
    <div class="px-5 py-4 border-b border-[var(--color-border)] bg-[var(--color-surface)] rounded-t-xl">
      <h1 class="font-semibold text-[var(--color-text)] text-lg">{{ _('bia.components.edit.heading', name=component.name) }}</h1>
      {% if component.context_scope %}
        <div class="text-[var(--color-muted)] text-sm mt-0.5">{{ component.context_scope.name }}</div>
      {% endif %}
    </div>

    <div class="p-6">
      <form action="{{ url_for('bia.edit_component_form', component_id=component.id) }}" method="POST">
        {{ form.hidden_tag() }}

        <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-6">

          <!-- Name -->
          <div>
            {{ render_field_with_help(form.name, class="w-full bg-[var(--color-surface)] border border-[var(--color-border)] rounded-lg px-3.5 py-2.5 text-[var(--color-text)] transition focus:outline-none focus:border-primary-500 focus:ring-2 focus:ring-primary-500/30") }}
          </div>

          <!-- BIA / Context -->
          <div>
            <label for="edit-bia-id" class="block text-sm font-medium mb-1.5 text-[var(--color-text)]">{{ _('bia.context_form.title') }}</label>
            <select name="bia_id" id="edit-bia-id" class="w-full bg-[var(--color-surface)] border border-[var(--color-border)] rounded-lg px-3.5 py-2.5 text-[var(--color-text)] transition focus:outline-none focus:border-primary-500 focus:ring-2 focus:ring-primary-500/30" required>
              {% for ctx in contexts %}
                <option value="{{ ctx.id }}" {% if component.context_scope and component.context_scope.id == ctx.id %}selected{% endif %}>{{ ctx.name }}</option>
              {% endfor %}
            </select>
          </div>

          <!-- Description -->
          <div class="md:col-span-2">
            {{ render_field_with_help(form.description, class="w-full bg-[var(--color-surface)] border border-[var(--color-border)] rounded-lg px-3.5 py-2.5 text-[var(--color-text)] transition focus:outline-none focus:border-primary-500 focus:ring-2 focus:ring-primary-500/30", rows=3) }}
          </div>

          <!-- Info Type -->
          <div>
            {{ render_field_with_help(form.info_type, class="w-full bg-[var(--color-surface)] border border-[var(--color-border)] rounded-lg px-3.5 py-2.5 text-[var(--color-text)] transition focus:outline-none focus:border-primary-500 focus:ring-2 focus:ring-primary-500/30") }}
          </div>

          <!-- User Type -->
          <div>
            {{ render_field_with_help(form.user_type, class="w-full bg-[var(--color-surface)] border border-[var(--color-border)] rounded-lg px-3.5 py-2.5 text-[var(--color-text)] transition focus:outline-none focus:border-primary-500 focus:ring-2 focus:ring-primary-500/30") }}
          </div>

          <!-- Owner -->
          <div>
            {{ render_field_with_help(form.info_owner, class="w-full bg-[var(--color-surface)] border border-[var(--color-border)] rounded-lg px-3.5 py-2.5 text-[var(--color-text)] transition focus:outline-none focus:border-primary-500 focus:ring-2 focus:ring-primary-500/30") }}
          </div>

          <!-- Dependencies -->
          <div>
            {{ render_field_with_help(form.dependencies_it_systems_applications, class="w-full bg-[var(--color-surface)] border border-[var(--color-border)] rounded-lg px-3.5 py-2.5 text-[var(--color-text)] transition focus:outline-none focus:border-primary-500 focus:ring-2 focus:ring-primary-500/30", rows=2) }}
          </div>
          <div>
            {{ render_field_with_help(form.dependencies_equipment, class="w-full bg-[var(--color-surface)] border border-[var(--color-border)] rounded-lg px-3.5 py-2.5 text-[var(--color-text)] transition focus:outline-none focus:border-primary-500 focus:ring-2 focus:ring-primary-500/30", rows=2) }}
          </div>
          <div>
            {{ render_field_with_help(form.dependencies_suppliers, class="w-full bg-[var(--color-surface)] border border-[var(--color-border)] rounded-lg px-3.5 py-2.5 text-[var(--color-text)] transition focus:outline-none focus:border-primary-500 focus:ring-2 focus:ring-primary-500/30", rows=2) }}
          </div>
          <div>
            {{ render_field_with_help(form.dependencies_people, class="w-full bg-[var(--color-surface)] border border-[var(--color-border)] rounded-lg px-3.5 py-2.5 text-[var(--color-text)] transition focus:outline-none focus:border-primary-500 focus:ring-2 focus:ring-primary-500/30", rows=2) }}
          </div>
          <div>
            {{ render_field_with_help(form.dependencies_facilities, class="w-full bg-[var(--color-surface)] border border-[var(--color-border)] rounded-lg px-3.5 py-2.5 text-[var(--color-text)] transition focus:outline-none focus:border-primary-500 focus:ring-2 focus:ring-primary-500/30", rows=2) }}
          </div>
          <div>
            {{ render_field_with_help(form.dependencies_others, class="w-full bg-[var(--color-surface)] border border-[var(--color-border)] rounded-lg px-3.5 py-2.5 text-[var(--color-text)] transition focus:outline-none focus:border-primary-500 focus:ring-2 focus:ring-primary-500/30", rows=2) }}
          </div>
        </div>

        <!-- AI Identification -->
        <div class="mb-6">
          <h4 class="text-base font-semibold text-[var(--color-text)] mb-3">{{ _('bia.components.modal.title') }}</h4>
          <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
            <div>
              {{ render_field_with_help(form.ai_category, class="w-full bg-[var(--color-surface)] border border-[var(--color-border)] rounded-lg px-3.5 py-2.5 text-[var(--color-text)] transition focus:outline-none focus:border-primary-500 focus:ring-2 focus:ring-primary-500/30") }}
            </div>
            <div>
              {{ render_field_with_help(form.ai_motivatie, class="w-full bg-[var(--color-surface)] border border-[var(--color-border)] rounded-lg px-3.5 py-2.5 text-[var(--color-text)] transition focus:outline-none focus:border-primary-500 focus:ring-2 focus:ring-primary-500/30", rows=3, placeholder=_("bia.components.modal.placeholder")) }}
            </div>
          </div>
        </div>

        <!-- Environments -->
        <div class="mb-6">
          <h4 class="text-base font-semibold text-[var(--color-text)] mb-3">{{ _('bia.components.environments.title') }}</h4>
          <div class="overflow-hidden rounded-lg border border-[var(--color-border)]">
            <table class="min-w-full divide-y divide-[var(--color-border)]">
              <thead class="bg-[var(--color-surface)]">
                <tr>
                  <th class="px-6 py-3 text-left text-xs font-medium text-[var(--color-muted)] uppercase tracking-wider">{{ _('bia.components.environments.type') }}</th>
                  <th class="px-6 py-3 text-left text-xs font-medium text-[var(--color-muted)] uppercase tracking-wider">{{ _('bia.components.environments.enabled') }}</th>
                  <th class="px-6 py-3 text-left text-xs font-medium text-[var(--color-muted)] uppercase tracking-wider">{{ _('bia.components.environments.auth_method') }}</th>
                </tr>
              </thead>
              <tbody class="divide-y divide-[var(--color-border)]">
                {% for environment_field in form.environments %}
                  <tr class="hover:bg-[var(--color-surface)]/50 transition-colors">
                    <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-[var(--color-text)]">
                      {{ environment_field.form.environment_type }}
                      {{ environment_field.form.environment_label }}
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-[var(--color-text)]">
                      {{ environment_field.form.is_enabled(class="rounded border-[var(--color-border)] text-primary-600 shadow-sm focus:border-primary-300 focus:ring focus:ring-primary-200 focus:ring-opacity-50") }}
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-[var(--color-text)]">
                      {{ environment_field.form.authentication_method(class="w-full bg-[var(--color-surface)] border border-[var(--color-border)] rounded text-sm px-2 py-1") }}
                    </td>
                  </tr>
                {% endfor %}
              </tbody>
            </table>
          </div>
        </div>

        <div class="flex justify-end gap-3 pt-4 border-t border-[var(--color-border)]">
          <a href="{{ url_for('bia.view_components') }}" class="inline-flex items-center justify-center font-medium rounded-md px-4 py-2 text-sm transition-colors border border-[var(--color-border)] text-[var(--color-muted)] hover:bg-slate-500/10">
            {{ _('bia.actions.cancel') }}
          </a>
          <button type="submit" class="inline-flex items-center justify-center font-medium rounded-md px-4 py-2 text-sm transition-colors border border-transparent bg-primary-600 text-white hover:bg-primary-700 shadow-sm">
            {{ _('bia.components.buttons.save_changes') }}
          </button>
        </div>

      </form>
    </div>
  </div>

</div>
{% endblock %}
