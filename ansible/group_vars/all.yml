---
app_name: scaffold
app_repo: https://github.com/fstelte/assessment-app.git
app_path: /opt/{{ app_name }}
virtualenv_path: {{ app_path }}/.venv
app_user: scaffold
app_group: scaffold
python_version: "3.11"
deployment_mode: default  # valid options: default, docker

flask_env: production
flask_port: 8000

# database connection for migrations (overridden per environment)
app_database_url: postgresql+psycopg://scaffold:scaffold@localhost:5432/scaffold

app_env:
  FLASK_ENV: "{{ flask_env }}"
  SECRET_KEY: "{{ vault_secret_key | default('', true) }}"
  DATABASE_URL: "{{ app_database_url }}"
  PORT: "{{ flask_port }}"
  SCAFFOLD_APP_MODULES: scaffold.apps.auth.routes,scaffold.apps.admin,scaffold.apps.bia,scaffold.apps.csa,scaffold.apps.template
  PASSWORD_LOGIN_ENABLED: "{{ vault_password_login_enabled | default('false', true) }}"
  SAML_SP_ENTITY_ID: "{{ vault_saml_sp_entity_id | default('', true) }}"
  SAML_SP_ACS_URL: "{{ vault_saml_sp_acs_url | default('', true) }}"
  SAML_SP_SLS_URL: "{{ vault_saml_sp_sls_url | default('', true) }}"
  SAML_SP_CERT: "{{ vault_saml_sp_cert | default('', true) }}"
  SAML_SP_PRIVATE_KEY: "{{ vault_saml_sp_private_key | default('', true) }}"
  SAML_IDP_ENTITY_ID: "{{ vault_saml_idp_entity_id | default('', true) }}"
  SAML_IDP_SSO_URL: "{{ vault_saml_idp_sso_url | default('', true) }}"
  SAML_IDP_SLO_URL: "{{ vault_saml_idp_slo_url | default('', true) }}"
  SAML_IDP_CERT: "{{ vault_saml_idp_cert | default('', true) }}"
  SAML_NAMEID_FORMAT: "{{ vault_saml_nameid_format | default('urn:oasis:names:tc:SAML:1.1:nameid-format:unspecified', true) }}"
  SAML_SIGN_AUTHN_REQUESTS: "{{ vault_saml_sign_authn_requests | default('', true) }}"
  SAML_SIGN_LOGOUT_REQUESTS: "{{ vault_saml_sign_logout_requests | default('', true) }}"
  SAML_SIGN_LOGOUT_RESPONSES: "{{ vault_saml_sign_logout_responses | default('', true) }}"
  SAML_WANT_MESSAGE_SIGNED: "{{ vault_saml_want_message_signed | default('', true) }}"
  SAML_WANT_ASSERTION_SIGNED: "{{ vault_saml_want_assertion_signed | default('true', true) }}"
  SAML_ALLOWED_GROUP_IDS: "{{ vault_saml_allowed_group_ids | default('', true) }}"
  SAML_ROLE_MAP: "{{ vault_saml_role_map | default('', true) }}"
  SAML_ATTRIBUTE_GROUPS: "{{ vault_saml_attribute_groups | default('http://schemas.microsoft.com/identity/claims/groups', true) }}"
  SAML_ATTRIBUTE_EMAIL: "{{ vault_saml_attribute_email | default('http://schemas.xmlsoap.org/ws/2005/05/identity/claims/emailaddress', true) }}"
  SAML_ATTRIBUTE_FIRST_NAME: "{{ vault_saml_attribute_first_name | default('http://schemas.xmlsoap.org/ws/2005/05/identity/claims/givenname', true) }}"
  SAML_ATTRIBUTE_LAST_NAME: "{{ vault_saml_attribute_last_name | default('http://schemas.xmlsoap.org/ws/2005/05/identity/claims/surname', true) }}"
  SAML_ATTRIBUTE_DISPLAY_NAME: "{{ vault_saml_attribute_display_name | default('http://schemas.xmlsoap.org/ws/2005/05/identity/claims/name', true) }}"
  SAML_ATTRIBUTE_OBJECT_ID: "{{ vault_saml_attribute_object_id | default('http://schemas.microsoft.com/identity/claims/objectidentifier', true) }}"
  SAML_ATTRIBUTE_UPN: "{{ vault_saml_attribute_upn | default('http://schemas.xmlsoap.org/ws/2005/05/identity/claims/upn', true) }}"
  SAML_STRICT: "{{ vault_saml_strict | default('true', true) }}"
  SAML_DEBUG: "{{ vault_saml_debug | default('', true) }}"

docker_env_path: "{{ app_path }}/.env.production"
docker_env:
  FLASK_ENV: "{{ flask_env }}"
  SECRET_KEY: "{{ vault_secret_key | default('', true) }}"
  DATABASE_URL: "postgresql+psycopg://scaffold:scaffold@postgres:5432/scaffold"
  PORT: "{{ flask_port }}"
  SCAFFOLD_APP_MODULES: scaffold.apps.auth.routes,scaffold.apps.admin,scaffold.apps.bia,scaffold.apps.csa,scaffold.apps.template
  PASSWORD_LOGIN_ENABLED: "{{ vault_password_login_enabled | default('false', true) }}"
  SAML_SP_ENTITY_ID: "{{ vault_saml_sp_entity_id | default('', true) }}"
  SAML_SP_ACS_URL: "{{ vault_saml_sp_acs_url | default('', true) }}"
  SAML_SP_SLS_URL: "{{ vault_saml_sp_sls_url | default('', true) }}"
  SAML_SP_CERT: "{{ vault_saml_sp_cert | default('', true) }}"
  SAML_SP_PRIVATE_KEY: "{{ vault_saml_sp_private_key | default('', true) }}"
  SAML_IDP_ENTITY_ID: "{{ vault_saml_idp_entity_id | default('', true) }}"
  SAML_IDP_SSO_URL: "{{ vault_saml_idp_sso_url | default('', true) }}"
  SAML_IDP_SLO_URL: "{{ vault_saml_idp_slo_url | default('', true) }}"
  SAML_IDP_CERT: "{{ vault_saml_idp_cert | default('', true) }}"
  SAML_NAMEID_FORMAT: "{{ vault_saml_nameid_format | default('urn:oasis:names:tc:SAML:1.1:nameid-format:unspecified', true) }}"
  SAML_SIGN_AUTHN_REQUESTS: "{{ vault_saml_sign_authn_requests | default('', true) }}"
  SAML_SIGN_LOGOUT_REQUESTS: "{{ vault_saml_sign_logout_requests | default('', true) }}"
  SAML_SIGN_LOGOUT_RESPONSES: "{{ vault_saml_sign_logout_responses | default('', true) }}"
  SAML_WANT_MESSAGE_SIGNED: "{{ vault_saml_want_message_signed | default('', true) }}"
  SAML_WANT_ASSERTION_SIGNED: "{{ vault_saml_want_assertion_signed | default('true', true) }}"
  SAML_ALLOWED_GROUP_IDS: "{{ vault_saml_allowed_group_ids | default('', true) }}"
  SAML_ROLE_MAP: "{{ vault_saml_role_map | default('', true) }}"
  SAML_ATTRIBUTE_GROUPS: "{{ vault_saml_attribute_groups | default('http://schemas.microsoft.com/identity/claims/groups', true) }}"
  SAML_ATTRIBUTE_EMAIL: "{{ vault_saml_attribute_email | default('http://schemas.xmlsoap.org/ws/2005/05/identity/claims/emailaddress', true) }}"
  SAML_ATTRIBUTE_FIRST_NAME: "{{ vault_saml_attribute_first_name | default('http://schemas.xmlsoap.org/ws/2005/05/identity/claims/givenname', true) }}"
  SAML_ATTRIBUTE_LAST_NAME: "{{ vault_saml_attribute_last_name | default('http://schemas.xmlsoap.org/ws/2005/05/identity/claims/surname', true) }}"
  SAML_ATTRIBUTE_DISPLAY_NAME: "{{ vault_saml_attribute_display_name | default('http://schemas.xmlsoap.org/ws/2005/05/identity/claims/name', true) }}"
  SAML_ATTRIBUTE_OBJECT_ID: "{{ vault_saml_attribute_object_id | default('http://schemas.microsoft.com/identity/claims/objectidentifier', true) }}"
  SAML_ATTRIBUTE_UPN: "{{ vault_saml_attribute_upn | default('http://schemas.xmlsoap.org/ws/2005/05/identity/claims/upn', true) }}"
  SAML_STRICT: "{{ vault_saml_strict | default('true', true) }}"
  SAML_DEBUG: "{{ vault_saml_debug | default('', true) }}"

scaffold_service_managed: true
scaffold_service_path: /etc/systemd/system/scaffold.service
gunicorn_bind: "0.0.0.0:{{ flask_port }}"
gunicorn_workers: 4

# docker specific
compose_project_name: scaffold
compose_src: {{ playbook_dir }}/../..
compose_file: docker/compose.prod.yml

# system packages required for default install
common_packages:
  - git
  - python3
  - python3-venv
  - python3-pip
  - build-essential
  - libpq-dev

docker_packages:
  - docker.io
  - docker-compose-plugin

